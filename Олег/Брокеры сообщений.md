# Брокеры сообщений

**Брокер сообщений (Message Broker)** — это промежуточное ПО, которое обеспечивает асинхронный обмен сообщениями между системами по принципу издатель-подписчик (pub/sub) или очередей.

### Как работает?
1.  **Издатель (Producer)** отправляет сообщение в брокер.
2.  **Брокер** сохраняет сообщение и гарантирует его доставку.
3.  **Подписчик (Consumer)** забирает сообщение из брокера, когда готов его обработать.

### Популярные брокеры
- **Apache Kafka:** Высокая пропускная способность, персистентность, перечитывание сообщений.
- **RabbitMQ:** Гибкая маршрутизация (AMQP), очереди.
- **ActiveMQ:** Поддержка JMS.

### Чем отличается от ESB?
| Характеристика | ESB (Оркестрация) | Брокер сообщений (Хореография) |
| :--- | :--- | :--- |
| **Архитектура** | Централизованная, "мозг" системы | Децентрализованная, "нервная система" |
| **Связность** | Жесткая связь через общую шину | Слабая связь, системы не знают друг о друге |
| **Основная задача** | Интеграция и трансформация | Асинхронная доставка и буферизация |
| **Подход** | Оркестрация (центральный компонент управляет процессом) | Хореография (каждая система реагирует на события самостоятельно) |

### Пример с Kafka
*Клиент читает в Kafka два последних сообщения. Как тому же клиенту заново прочитать эти два последние сообщения?*
В Kafka сообщения хранятся в топиках и имеют offset (смещение). Чтобы перечитать сообщения, клиент может:
1.  Сбросить свой consumer offset для этого топика на более раннее значение.
2.  Использовать новый consumer group.
3.  Сохранить offset сообщений и явно указать их при следующем чтении.

---
#### Связанные заметки:
- [[ESB (Корпоративная шина)]]
- [[Архитектура Event-Driven]]
- [[Хореография и Оркестрация]]
- [[Apache Kafka]]